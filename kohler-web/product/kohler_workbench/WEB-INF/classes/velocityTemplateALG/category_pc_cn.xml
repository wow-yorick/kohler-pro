<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" name="productListData" param="@category_metadata_id,@template_type,@lang">

	<!-- 面包屑 -->
	<funcdata name="breadcrumb_name" from="getBreadcrumb" />
	
	<!-- seo信息 -->
	<data name="seo" tableName="VW_CATEGORY" filter="CATEGORY_METADATA_ID=@category_metadata_id AND LANG=@lang">
		<field name="seo_title" fieldType="physicalValue" fieldName="IF(@template_type = 'pc', SEO_TITLE_PC, SEO_TITLE_MOBILE)"/>
		<field name="seo_keywords" fieldType="physicalValue" fieldName="IF(@template_type = 'pc', SEO_KEYWORDS_PC, SEO_KEYWORDS_MOBILE)"/>
		<field name="seo_description" fieldType="physicalValue" fieldName="IF(@template_type = 'pc', SEO_DESCRIPTION_PC, SEO_DESCRIPTION_MOBILE)"/>
		<field name="category_name" fieldType="physicalValue" fieldName="CATEGORY_NAME"/>
		<field name="breadcrumb_name" fieldType="physicalValue" fieldName="BREADCRUMB_NAME"/>
	</data>
	
	<!-- hero_areas -->
	<multidata name="hero_areas" contentType="CONTENT_FIELD_VALUES" sqlResource="SELECT FIELD_VALUE,FIELD_NAME ,area.CATEGORY_METADATA_ID,cv.CONTENT_METADATA_ID 
	  FROM CONTENT_FIELD_VALUES cv LEFT JOIN CATEGORY_HERO_AREA area ON cv.CONTENT_METADATA_ID = area.HERO_AREA_METADATA_ID 
	   WHERE area.IS_ENABLE=1 AND cv.IS_ENABLE=1 AND cv.LANG =@lang AND area.CATEGORY_METADATA_ID=@category_metadata_id ORDER BY area.SEQ_NO,area.CATEGORY_HERO_AREA_ID">
		 <field name="FIELD_NAME"  fieldType="physicalValue" fieldName="FIELD_NAME" />
		 <field name="FIELD_VALUE"  fieldType="physicalValue" fieldName="FIELD_VALUE" />
		 <field name="CONTENT_METADATA_ID"  fieldType="physicalValue" fieldName="CONTENT_METADATA_ID" />
		 <map name="CONTENT_FIELD_VALUES">
			<field name="seq_no"  fieldName="SeqNo"/>
			<field name="operation"  fieldName="Operation"/>
			<field name="target_url"  fieldName="Target URL"/>
			<field name="image_overlay_text"  fieldName="Image Overlay Text"/>
			<field name="image_alt"  fieldName="Image Alt"/>
			<field name="image_url"  fieldName="Image Id"/>
			<field name="title"  fieldName="Title"/>
		</map>
	</multidata>
	
	<!-- 子分类 -->
	 <multidata name="Categories" keyName="CATEGORY_METADATA_ID" tableName="VW_CATEGORY" filter="PARENT_ID=@category_metadata_id AND LANG=@lang ORDER BY SEQ_NO,CATEGORY_ID">
		<field name="category_name" fieldType="physicalValue" fieldName="CATEGORY_NAME"/>
		<field name="category_id" fieldType="physicalValue" fieldName="CATEGORY_ID"/>
		<field name="category_metadata_id" fieldType="physicalValue" fieldName="CATEGORY_METADATA_ID"/>
		<field name="template_id"  fieldType="physicalValue" fieldName="IF(@template_type = 'pc', PC_TEMPLATE_ID, MOBILE_TEMPLATE_ID)" />
		<field name="url" fieldType="urlValue" dependOn="category_metadata_id"  service="categoryUrlAnalysis" />
	</multidata>
	
	<!-- 公共属性 -->
	<multidata name="CommonAttributes" keyName="CATEGORY_COM_ATTR_METADATA_ID" sqlResource="SELECT CATEGORY_COM_ATTR_METADATA_ID,CATEGORY_COM_ATTR_NAME,KEY_NAME,INPUT_TYPE, IS_FILTER, 
	 IMAGE_URL,IMAGE_SOURCE,IMAGE_ID,IMAGE_TOOLTIP FROM VW_CATEGORY_COM_ATTR WHERE CATEGORY_METADATA_ID = @category_metadata_id AND LANG = @lang" >
	 		<field name="CATEGORY_COM_ATTR_METADATA_ID" fieldType="physicalValue" fieldName="CATEGORY_COM_ATTR_METADATA_ID" />
			<field name="category_com_attr_name" fieldType="physicalValue" fieldName="CATEGORY_COM_ATTR_NAME" />
			<field name="key_name" fieldType="physicalValue" fieldName="KEY_NAME" />
			<field name="input_type" fieldType="physicalValue" fieldName="INPUT_TYPE"/>
			<field name="is_filter" fieldType="physicalValue" fieldName="IS_FILTER" />
			<field name="image_source" fieldType="physicalValue" fieldName="IMAGE_SOURCE" />
			<field name="image_url" fieldType="physicalValue" fieldName="IMAGE_URL" />
			<field name="image_id" fieldType="physicalValue" fieldName="IMAGE_ID" />
			<field name="image_tooltip" fieldType="physicalValue" fieldName="IMAGE_TOOLTIP" />
			<field name="image_url" fieldType="physicalValue" fieldName="IMAGE_URL" />
			
			<multidata name="CommonAttributes_value"  sqlResource="SELECT DISTINCT VALUE,PRODUCT_METADATA_ID 
			 FROM PRODUCT_COM_ATTR WHERE CATEGORY_COM_ATTR_METADATA_ID =@@CATEGORY_COM_ATTR_METADATA_ID AND IS_ENABLE = 1 AND LANG = @lang 
			  GROUP BY VALUE" >
	 			<field name="product_metadata_id" fieldType="physicalValue" fieldName="PRODUCT_METADATA_ID" />
	 			<field name="value" fieldType="physicalValue" fieldName="VALUE" />
	 		</multidata>
			
	</multidata>
	
	<multidata name="products" sqlResource="SELECT vp.PRODUCT_METADATA_ID, vp.PRODUCT_NAME,cl.COLLECTION_NAME,sa.SKU_CODE,sa.SKU_PRICE,sa.LIST_IMAGE_ALT,sa.IMAGE_SOURCE,sa.LIST_IMAGE_URL,sa.LIST_IMAGE_ID
FROM VW_PRODUCT vp 
LEFT JOIN VW_COLLECTION cl ON vp.COLLECTION_METADATA_ID = cl.COLLECTION_METADATA_ID AND cl.LANG = @lang 
LEFT JOIN VW_SKU sa ON vp.PRODUCT_METADATA_ID = sa.PRODUCT_METADATA_ID AND sa.IS_DEFAULT = 1 
WHERE vp.CATEGORY_METADATA_ID = @category_metadata_id AND vp.lang = @lang 
ORDER BY sa.SKU_PRICE DESC,vp.PRODUCT_METADATA_ID" >
		<field name="product_metadata_id" fieldType="physicalValue" fieldName="PRODUCT_METADATA_ID" />
		<field name="name" fieldType="physicalValue" fieldName="PRODUCT_NAME" />
		<field name="image_source" fieldType="physicalValue" fieldName="IMAGE_SOURCE" />
		<field name="list_image_url" fieldType="physicalValue" fieldName="LIST_IMAGE_URL" />
		<field name="list_image_id" fieldType="physicalValue" fieldName="LIST_IMAGE_ID" />
		<field name="collection" fieldType="physicalValue" fieldName="COLLECTION_NAME" />
		<field name="sku_code" fieldType="physicalValue" fieldName="SKU_CODE"/>
		<field name="image_alt" fieldType="physicalValue" fieldName="LIST_IMAGE_ALT"/>
		<field name="target_url" fieldType="urlValue" dependOn="product_metadata_id"  service="productUrlAnalysis" />
	</multidata>
	
	<!-- 购买属性 -->
	<multidata name="SKUAttributes" keyName="CATEGORY_SKU_ATTR_METADATA_ID"  tableName="VW_CATEGORY_SKU_ATTR" filter="CATEGORY_METADATA_ID=@category_metadata_id AND LANG=@lang"  >
			<field name="sku_attr_name" fieldType="physicalValue" fieldName="CATEGORY_SKU_ATTR_NAME" />
			<multidata name="SKUAttributes_value"   tableName="VW_CATEGORY_SKU_ATTR_VALUES" filter="CATEGORY_SKU_ATTR_METADATA_ID=@@CATEGORY_SKU_ATTR_METADATA_ID AND LANG=@lang"  >
				<field name="sku_attr_value" fieldType="physicalValue" fieldName="ATTR_VALUE" />
			</multidata>
	</multidata>
	
	<!-- 系列 -->
	<multidata name="Collections"  tableName="COLLECTION" filter="LANG=@lang AND IS_ENABLE = 1"  >
			<field name="collection_name" fieldType="physicalValue" fieldName="COLLECTION_NAME" />
	</multidata>
		
	
	<!-- bunner_unit -->
	<multidata name="banner_units" contentType="CONTENT_FIELD_VALUES" sqlResource="SELECT FIELD_VALUE,FIELD_NAME ,unit.CATEGORY_METADATA_ID,cv.CONTENT_METADATA_ID 
  FROM CONTENT_FIELD_VALUES cv LEFT JOIN CATEGORY_BANNER_UNIT unit ON cv.CONTENT_METADATA_ID = unit.BANNER_UNIT_METADATA_ID 
   WHERE unit.IS_ENABLE=1 AND cv.IS_ENABLE=1 AND cv.LANG =1 AND unit.CATEGORY_METADATA_ID = @category_metadata_id ORDER BY unit.SEQ_NO,unit.CATEGORY_BANNER_UNIT_ID">
		 <field name="FIELD_NAME"  fieldType="physicalValue" fieldName="FIELD_NAME" />
		 <field name="FIELD_VALUE"  fieldType="physicalValue" fieldName="FIELD_VALUE" />
		 <field name="CONTENT_METADATA_ID"  fieldType="physicalValue" fieldName="CONTENT_METADATA_ID" />
		 <map name="CONTENT_FIELD_VALUES">
			<field name="seq_no"  fieldName="SeqNo"/>
			<field name="description"  fieldName="Description"/>
			<field name="operation"  fieldName="Operation"/>
			<field name="file_id"  fieldName="File Id"/>
			<field name="type"  fieldName="Type"/>
			<field name="target_url"  fieldName="Target URL"/>
			<field name="image_overlay_text"  fieldName="Image Overlay Text"/>
			<field name="image_alt"  fieldName="Image Alt"/>
			<field name="title"  fieldName="Title"/>
		</map>
	</multidata>	
	
</page>
